"use strict";(self.webpackChunk_coreui_coreui_free_react_admin_template=self.webpackChunk_coreui_coreui_free_react_admin_template||[]).push([[854],{6947:(e,t,s)=>{s.d(t,{Z:()=>l});s(2791);var i=s(3329);const l=e=>(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("div",{className:" ".concat(e.fullWidth?"w-full":null," inline-flex flex-col border-b border-customRed-900 shadow-lg"),children:[(0,i.jsx)("div",{className:"flex flex-row flex-wrap gap-4 px-4 py-2 text-white bg-customRed-900",children:(0,i.jsx)("h2",{className:"text-2xl font-semibold mb-2 capitalize",children:e.title})}),(0,i.jsx)("div",{className:"bg-white flex w-full",children:e.body})]})})},854:(e,t,s)=>{s.r(t),s.d(t,{default:()=>k});var i=s(2791),l=s(6947),a=s(6961);const o={control:(e,t)=>({...e,borderColor:t.isFocused?"#da200d":"",boxShadow:t.isFocused?"0 0 0 0.25rem #e7b7b4":null,borderRadius:0}),container:e=>({...e,width:"100%"}),menu:(e,t)=>({...e,width:"100%"}),option:(e,t)=>({...e,backgroundColor:t.isSelected?"#da200d":"inherit",":hover":{backgroundColor:"#e7b7b4"}})};var r=s(9390),h=s.n(r),n=s(4802),u=s(7385),m=s(3329);var c=s(9434),d=s(5238),f=s(7689),C=s(4956);s(8917);const g=class{constructor(e){this.employeurData=null,this.period=null,this.periodSelectionne=null,this.worksheet=e.addWorksheet("EMPLOYER",{properties:{tabColor:{argb:"00CCFF"}}}),this.colA=this.worksheet.getColumn(1),this.colB=this.worksheet.getColumn(2),this.CellB30=this.worksheet.getCell("B30"),this.row18=this.worksheet.getRow(18),this.row21=this.worksheet.getRow(21),this.f22=this.worksheet.getCell("F22"),this.f23=this.worksheet.getCell("F23"),this.f24=this.worksheet.getCell("F24"),this.f25=this.worksheet.getCell("F25"),this.f26=this.worksheet.getCell("F26")}setPeriodeSelectionne(e){this.periodSelectionne=e}setEmployeurData(e){this.employeurData=e}setPeriod(e){this.period=e}setDefaultFont(){this.worksheet.eachRow(((e,t)=>{e.eachCell(((t,s)=>{t.value&&(e.getCell(s).font={name:"Arial",size:10})}))}))}isEmployeurExist(){return null!==this.employeurData&&void 0!==this.employeurData}verifyCellNotMerged(e,t){return this.worksheet.getCell(e).style!==this.worksheet.getCell(t).style}formatC4ToC9(){for(let e=4;e<=9;e++){this.verifyCellNotMerged("C".concat(e),"F".concat(e))&&this.worksheet.mergeCells("C".concat(e,":F").concat(e)),this.isEmployeurExist()&&(4===e&&(this.worksheet.getCell("C".concat(e)).value=this.employeurData.rcs||null),5===e&&(this.worksheet.getCell("C".concat(e)).value=this.employeurData.nom||null),6===e&&(this.worksheet.getCell("C".concat(e)).value=this.employeurData.nif||null),7===e&&(this.worksheet.getCell("C".concat(e)).value=this.employeurData.tel||null),8===e&&(this.worksheet.getCell("C".concat(e)).value=this.employeurData.adresse||null),9===e&&(this.worksheet.getCell("C".concat(e)).value=this.employeurData.email||null)),this.worksheet.getColumn(e).width=17,this.worksheet.getCell("C".concat(e)).border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}}isPeriodExist(){return null!==this.period&&void 0!==this.period}formatC12ToC16(){for(let e=12;e<=16;e++)this.isPeriodExist()&&12===e&&this.period.length>0&&(this.worksheet.getCell("C".concat(e)).value=this.period),this.worksheet.getCell("C".concat(e)).border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}formatC18ToE18(){for(let e=3;e<6;e++)this.row18.getCell(e).border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}formatC21ToE21(){for(let e=3;e<6;e++)this.row21.getCell(e).value="Mois ".concat(e-2),this.row21.getCell(e).border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},this.row21.getCell(e).font={name:"Arial",bold:!0,size:10},this.row21.getCell(e).alignment={vertical:"middle",horizontal:"center"}}formatB22ToF25(){for(let e=22;e<26;e++){let t=this.worksheet.getRow(e);t||(t=this.worksheet.addRow({number:e}));for(let e=2;e<=6;e++)t.getCell(e).border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}}formatF22(){this.f22.value="TOTAUX",this.f22.font={name:"Arial",bold:!0,size:10},this.f22.alignment={vertical:"middle",horizontal:"center"}}formatF26(){this.f26.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}insertFormulaToF23(){this.f23.value={formula:"SUM(C23,E23)"}}insertFormulaToF24(){this.f24.value={formula:"SUM(C24:E24)"}}insertFormulaToF25(){this.f25.value={formula:"SUM(C25:E25)"}}insertFormulaToF26(){this.f26.value={formula:"SUM(F24:F25)"}}isPeriodeSelectionneT1(){return"t1"===this.periodSelectionne}isPeriodeSelectionneT2(){return"t2"===this.periodSelectionne}isPeriodeSelectionneT3(){return"t3"===this.periodSelectionne}insertValueToC18ToE18(){this.isPeriodeSelectionneT1()&&(this.worksheet.getCell("C18").value="Janvier",this.worksheet.getCell("D18").value="F\xe9vrier",this.worksheet.getCell("E18").value="Mars"),this.isPeriodeSelectionneT2()&&(this.worksheet.getCell("C18").value="Avril",this.worksheet.getCell("D18").value="Mai",this.worksheet.getCell("E18").value="Juin"),this.isPeriodeSelectionneT3()&&(this.worksheet.getCell("C18").value="Juillet",this.worksheet.getCell("D18").value="Ao\xfbt",this.worksheet.getCell("E18").value="Septembre")}createSheetContent(){this.worksheet.getColumn(3).width=17,this.colA.width=5.5,this.colA.values=[null,"RENSEIGNEMENTS SUR L'EMPLOYEUR :",null,null,null,null,null,null,null,null,"COTISATIONS :",null,null,null,null,null,null,"MOIS CONCERNES :",null,null,"RECAPITULATION :"],this.colB.width=28.14,this.colB.values=[null,null,null,"N\xb0 MATRICULE","RAISON SOCIALE","N\xb0 NIF(nouveau)","N\xb0 T\xe9l\xe9phone","ADRESSE","Adresse email",null,null,"P\xe9riode et Ann\xe9e","Mode de paiement","R\xe9f\xe9rence","Taux Employeur","Taux Travailleur",null,null,null,null,null,"Effectif mensuel (OBLIGATOIRE)","Totaux Salaires non plafonn\xe9s","Cotisations Employeur","Cotisations travailleurs",null,null,null,null,"** Reporter ci-dessus les totaux obtenus dans les onglets Mois 1, 2 et 3."],this.setDefaultFont(),this.formatC4ToC9(),this.formatC12ToC16(),this.formatC18ToE18(),this.formatC21ToE21(),this.formatB22ToF25(),this.formatF22(),this.formatF26(),this.insertFormulaToF23(),this.insertFormulaToF24(),this.insertFormulaToF25(),this.insertFormulaToF26(),this.insertValueToC18ToE18(),this.CellB30.font={italic:!0,bold:!0},this.colA.font={name:"Arial",bold:!0,underline:!0,size:10}}};var p=s(7420),w=s(9098),v=s(4890);const S=class{constructor(e,t,s){this.injectData=()=>{this.isTravailleurDataExist()?(this.formatData(),this.fillCollData()):console.log("no data")},this.resetData=()=>{this.travailleurData=null,this.clearAllCellValues()},this.monthLabel=null,this.workbook=e,this.tabColor=null,this.travailleurData=null,this.formatedData=[],this.employeurData=null,this.startCharCode="A".charCodeAt(0),this.endCharCode="P".charCodeAt(0),this.columnNames=[],this.columnData=["date","nom","prenom","num_cnaps","ref_employeur","date_embauche","date_depart","salaire_du_mois","avantage_du_mois","temps_presence","non_plafonne","plafonne","taux_cotisation_cnaps_employeur","taux_cotisation_cnaps_salarie","cotisation_total","cin"],this.generateColumnNames(),this.worksheet=e.addWorksheet(t,{properties:{tabColor:{argb:s}}})}setTravailleurData(e){this.travailleurData=e}setEmployeurData(e){this.employeurData=e}isTravailleurDataExist(){return null!==this.travailleurData&&void 0!==this.travailleurData}isEmployeurDataExist(){return console.log(this.employeurData),null!==this.employeurData&&void 0!==this.employeurData}formatDate(e,t){try{const s="".concat(e,"-").concat(t,"-01"),i=(0,p.Z)(s,"yyyy-MMMM-dd",new Date,{locale:v.Z});return"".concat(i.getFullYear()).concat((i.getMonth()+1).toString().padStart(2,"0"))}catch(s){return console.error("Error formatting date:",s),""}}formatData(){this.isTravailleurDataExist()?(console.log(this.travailleurData),this.formatedData=this.travailleurData.map(((e,t)=>{const s=194e4;return{...e,date:this.formatDate(e.annee,e.mois),date_embauche:e.date_embauche?(0,w.Z)(new Date(e.date_embauche),"dd/MM/yyyy"):"",date_depart:e.date_depart?(0,w.Z)(new Date(e.date_depart),"dd/MM/yyyy"):"",non_plafonne:{formula:"SUM(H".concat(t+3,",I").concat(t+3,")")},plafonne:{formula:"=IF(K".concat(t+3," <= ").concat(s,", K").concat(t+3,", ").concat(s,")")},cotisation_employeur:{formula:"".concat(e.taux_cotisation_cnaps_employeur,"*L").concat(t+3)},cotisaton_travailleur:{formula:"".concat(e.taux_cotisation_cnaps_salarie,"*L").concat(t+3)},cotisation_total:{formula:"M".concat(t+3,"+N").concat(t+3)}}}))):console.log("Impossible de g\xe9n\xe9rer le contenu de l'onglet mois")}generateColumnNames(){for(let e=this.startCharCode;e<=this.endCharCode;e++){const t=String.fromCharCode(e);this.columnNames.push(t)}}fillCollData(){for(let e=0;e<this.columnNames.length;e++){const t=this.columnNames[e],s=this.columnData[e];for(let e=0;e<this.formatedData.length;e++){const i=e+3;this.worksheet.getCell("".concat(t).concat(i)).value=this.formatedData[e][s]}}}initializeHeaders(){this.A1=this.worksheet.getCell("A1"),this.B1=this.worksheet.getCell("B1"),this.B2=this.worksheet.getCell("B2"),this.C2=this.worksheet.getCell("C2"),this.D1=this.worksheet.getCell("D1"),this.E1=this.worksheet.getCell("E1"),this.F1=this.worksheet.getCell("F1"),this.F2=this.worksheet.getCell("F2"),this.G2=this.worksheet.getCell("G2"),this.H1=this.worksheet.getCell("H1"),this.I1=this.worksheet.getCell("I1"),this.J1=this.worksheet.getCell("J1"),this.K1=this.worksheet.getCell("K1"),this.K2=this.worksheet.getCell("K2"),this.L2=this.worksheet.getCell("L2"),this.M1=this.worksheet.getCell("M1"),this.M2=this.worksheet.getCell("M2"),this.N2=this.worksheet.getCell("N2"),this.O2=this.worksheet.getCell("O2"),this.P1=this.worksheet.getCell("P1")}verifyCellNotMerged(e,t){return this.worksheet.getCell(e).style!==this.worksheet.getCell(t).style}setLabel(e){this.monthLabel=e}setTabColor(e){this.tabColor=e}adjustColumnWidths(){this.worksheet.columns.forEach(((e,t)=>{let s=0;this.worksheet.eachRow({includeEmpty:!0},(e=>{const i=e.getCell(t+1).value,l=i?String(i).length:0;s=Math.max(s,l)})),e.width=Math.max(10,Math.min(30,s+2))}))}formatCellToNumberDecima(){if(this.isTravailleurDataExist())for(let e=0;e<=this.formatedData.length;e++){const t=e+3;this.worksheet.getCell("H".concat(t)).numFmt="0.00",this.worksheet.getCell("I".concat(t)).numFmt="0.00",this.worksheet.getCell("K".concat(t)).numFmt="0.00",this.worksheet.getCell("L".concat(t)).numFmt="0.00",this.worksheet.getCell("M".concat(t)).numFmt="0.00",this.worksheet.getCell("N".concat(t)).numFmt="0.00",this.worksheet.getCell("O".concat(t)).numFmt="0.00"}}setDefaultFont(){this.adjustColumnWidths(),this.worksheet.eachRow((e=>{e.eachCell((e=>{e.font={name:"Arial Narrow",size:9},e.alignment={vertical:"middle",horizontal:"center"},e.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}))}))}formatA1(){this.A1.width="2.3cm",this.A1.value="ANNEE-MOIS",this.verifyCellNotMerged("A1","A2")&&this.worksheet.mergeCells("A1:A2")}formatB1(){this.B1.width="6cm",this.B1.value="TRAVAILLEURS",this.verifyCellNotMerged("B1","C1")&&this.worksheet.mergeCells("B1:C1")}formatB2(){this.B2.value="NOM"}formatC2(){this.C2.value="PRENOMS"}formatD1(){this.D1.width="2.3cm",this.D1.value="N\xb0 CNaPS",this.verifyCellNotMerged("D1","D2")&&this.worksheet.mergeCells("D1:D2")}formatE1(){this.E1.width="2.3cm",this.E1.value="R\xe9f. Employeur",this.verifyCellNotMerged("E1","E2")&&this.worksheet.mergeCells("E1:E2")}formatF1(){this.F1.value="DATE",this.verifyCellNotMerged("F1","G1")&&this.worksheet.mergeCells("F1:G1")}formatF2(){this.F2.value="ENTREE"}formatG2(){this.G2.value="DEPART"}formatH1(){this.H1.value="SALAIRE DU MOIS",this.verifyCellNotMerged("H1","H2")&&this.worksheet.mergeCells("H1:H2")}formatI1(){this.I1.value="AVANTAGE DU MOIS",this.verifyCellNotMerged("I1","I2")&&this.worksheet.mergeCells("I1:I2")}formatJ1(){this.J1.value="TEMPS PRESENCE",this.verifyCellNotMerged("J1","J2")&&this.worksheet.mergeCells("J1:J2")}formatK1(){this.K1.value="TOTAL",this.verifyCellNotMerged("K1","L1")&&this.worksheet.mergeCells("K1:L1")}formatK2(){this.K2.value="NON PLAFONNE"}formatL2(){this.L2.value="PLAFONNE"}formatM1(){this.M1.value="COTISATIONS",this.verifyCellNotMerged("M1","O1")&&this.worksheet.mergeCells("M1:O1")}formatM2(){this.M2.value="EMPLOYEUR"}formatN2(){this.N2.value="TRAVAILLEUR"}formatO2(){this.O2.value="TOTAL"}formatP1(){this.P1.value="N\xb0 CIN/N\xb0PASSEPORT",this.verifyCellNotMerged("P1","P2")&&this.worksheet.mergeCells("P1:P2")}createSheetContent(){this.initializeHeaders(),this.formatA1(),this.formatB1(),this.formatB2(),this.formatC2(),this.formatD1(),this.formatE1(),this.formatF1(),this.formatF2(),this.formatG2(),this.formatH1(),this.formatI1(),this.formatJ1(),this.formatK1(),this.formatK2(),this.formatL2(),this.formatM1(),this.formatM2(),this.formatN2(),this.formatO2(),this.formatP1(),this.injectData(),this.formatCellToNumberDecima(),this.setDefaultFont()}clearAllCellValues(){for(let e=0;e<this.formatedData.length;e++){const t=e+3;this.worksheet.spliceRows(t,1)}}};class y extends i.Component{constructor(e){super(e),this.isSalariesExist=()=>void 0!==this.salaries&&null!==this.salaries,this.getListSalarieMois1=()=>{if(this.listSalarieMois1=[],this.isSalariesExist())for(let e=0;e<this.salaries.length;e++)this.mois1List.includes(this.salaries[e].mois)&&this.salaries[e].trimestre===this.store.dns.periodSelectionne&&this.listSalarieMois1.push(this.salaries[e])},this.getListSalarieMois2=()=>{if(this.listSalarieMois2=[],this.isSalariesExist())for(let e=0;e<this.salaries.length;e++)this.mois2List.includes(this.salaries[e].mois)&&this.salaries[e].trimestre===this.store.dns.periodSelectionne&&this.listSalarieMois2.push(this.salaries[e])},this.getListSalarieMois3=()=>{if(this.listSalarieMois3=[],this.isSalariesExist())for(let e=0;e<this.salaries.length;e++)this.mois3List.includes(this.salaries[e].mois)&&this.salaries[e].trimestre===this.store.dns.periodSelectionne&&this.listSalarieMois3.push(this.salaries[e])},this.isDnsDataExist=()=>null!==this.dnsData&&void 0!==this.dnsData&&Array.from(this.dnsData).length>0,this.isEmployeurDataExist=()=>null!==this.store.employeur.employeur&&void 0!==this.store.employeur.employeur,this.handleExport=async e=>{e.preventDefault(),this.store=u.h.getState(),this.formatPeriod(),this.employeurData=this.isEmployeurDataExist()?this.store.employeur.employeur:[],this.listSalarieMois1&&(this.mois1WorkSheet.setTravailleurData(this.listSalarieMois1),this.mois1WorkSheet.createSheetContent()),this.listSalarieMois2&&(this.mois2WorkSheet.setTravailleurData(this.listSalarieMois2),this.mois2WorkSheet.createSheetContent()),this.listSalarieMois3&&(this.mois3WorkSheet.setTravailleurData(this.listSalarieMois3),this.mois3WorkSheet.createSheetContent()),this.period&&this.employeurSheet.setPeriod(this.period),this.isEmployeurDataExist()&&(this.employeurSheet.setPeriodeSelectionne(this.store.dns.periodSelectionne),this.employeurSheet.setEmployeurData(this.employeurData[0]),this.employeurSheet.createSheetContent()),this.wb.xlsx.writeBuffer().then((e=>{const t=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});n.saveAs(t,"declaration_CNAPS_".concat(this.store.dns.periodSelectionne.toUpperCase(),"_").concat(this.store.dns.anneeSelectionne,".xlsx"))})),this.mois1WorkSheet.resetData(),this.mois2WorkSheet.resetData(),this.mois3WorkSheet.resetData()},this.wb=new(h().Workbook),this.employeurSheet=new g(this.wb),this.mois1WorkSheet=new S(this.wb,"Mois 1","ffff00"),this.mois2WorkSheet=new S(this.wb,"Mois 2","99ccff"),this.mois3WorkSheet=new S(this.wb,"Mois 3","00ccff"),this.mois1List=["janvier","avril","juillet"],this.mois2List=["fevrier","mai","ao\xfbt"],this.mois3List=["mars","juin","septembre"],this.store=null,this.dnsData=null,this.listSalarie=null,this.employeurData=null,this.listSalarieMois1=null,this.listSalarieMois2=null,this.listSalarieMois3=null,this.period=null,this.salaries=null,this.listSalarie=this.isDnsDataExist()?this.dnsData[0].travailleurs:[],this.state={anneSelectionne:null,periodeSelectionne:null}}componentDidMount(){this.store=u.h.getState(),this.dnsData=this.isDnsDataExist()?this.store.dns.dnsData:[],this.salaries=this.isDnsDataExist()?this.dnsData[0].travailleurs:[],this.getListSalarieMois1(this.salaries),this.getListSalarieMois2(this.salaries),this.getListSalarieMois3(this.salaries)}componentDidUpdate(){this.store=u.h.getState(),this.dnsData=this.store.dns.dnsData,this.salaries=this.isDnsDataExist()&&this.dnsData[0].travailleurs,this.getListSalarieMois1(this.salaries),this.getListSalarieMois2(this.salaries),this.getListSalarieMois3(this.salaries)}formatPeriod(){switch(this.store.dns.periodSelectionne){case"t1":this.period="01-"+this.store.dns.anneeSelectionne.toString();break;case"t2":this.period="04-"+this.store.dns.anneeSelectionne.toString();break;case"t3":this.period="07-"+this.store.dns.anneeSelectionne.toString()}}render(){return(0,m.jsx)(m.Fragment,{children:(0,m.jsx)("div",{children:(0,m.jsx)("button",{type:"submit",className:"bg-customRed-900 text-white hover:bg-customRed-200 py-2 px-3 hover:text-slate-200",onClick:this.handleExport,children:"G\xe9n\xe9rer"})})})}}const D=y,k=()=>{const e=()=>{const e=(0,f.TH)().pathname,t=(0,c.I0)(),s=(0,c.v9)((e=>e.dns)),l=(0,c.v9)((e=>e.dns.dsnData)),r=(0,c.v9)((e=>e.dns.loading)),h=(0,c.v9)((e=>e.dns.periodSelectionne)),n=(0,c.v9)((e=>e.dns.anneeSelectionne)),[u,g]=(0,i.useState)("t1"),[p,w]=(0,i.useState)((new Date).getFullYear()),[v,S]=(0,i.useState)(u),[y,k]=(0,i.useState)(p),E=[{value:"t1",label:"Trimestre 1"},{value:"t2",label:"Trimestre 2"},{value:"t3",label:"Trimestre 3"}];(0,i.useEffect)((()=>{g((null===s||void 0===s?void 0:s.periodSelectionne)||"t1"),w((null===s||void 0===s?void 0:s.anneeSelectionne)||(new Date).getFullYear()),S((null===s||void 0===s?void 0:s.periodSelectionne)||"t1"),k((null===s||void 0===s?void 0:s.anneeSelectionne)||(new Date).getFullYear())}),[t,e,s,u,p,l,r]),(0,i.useEffect)((()=>{t((0,C.H)({periode:h,annee:n}))}),[]);const M=(new Date).getFullYear(),b=Array.from({length:M-1900+1},((e,t)=>({value:M-t,label:(M-t).toString()}))),x=(e,i)=>{"periode"===i.name?(t((0,d.ZW)({...s,periodSelectionne:e.value})),S(e.value),t((0,C.H)({periode:e.value,annee:y}))):"annee"===i.name&&(t((0,d.ZW)({...s,anneeSelectionne:e.value})),k(e.value),t((0,C.H)({periode:v,annee:e.value})))};return(0,m.jsx)(m.Fragment,{children:(0,m.jsx)("form",{action:"post",className:"w-full flex flex-col gap-2 p-4",children:(0,m.jsxs)("div",{className:"w-full flex flex-row gap-2 justify-between flex-wrap items-end",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"form-label",htmlFor:"periode",children:"P\xe9riode"}),(0,m.jsx)(a.ZP,{className:"basic-multi-select",name:"periode",options:E,onChange:(e,t)=>x(e,t),value:E.find((e=>e.value===v)),styles:o})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"form-label",htmlFor:"annee",children:"Ann\xe9e"}),(0,m.jsx)(a.ZP,{className:"basic-multi-select",name:"annee",options:b,onChange:(e,t)=>x(e,t),value:b.find((e=>e.value===y)),styles:o})]}),(0,m.jsx)("div",{className:"flex",children:(0,m.jsx)(D,{})})]})})})};return(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(l.Z,{body:(0,m.jsx)(e,{}),title:"D\xe9claration nominative de salaires"})})}}}]);
//# sourceMappingURL=854.bd9231c6.chunk.js.map